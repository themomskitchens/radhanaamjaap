<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Naam Jaap</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Poppins,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.container{max-width:400px;width:100%;text-align:center;padding:20px}
.hidden{display:none}
input,button{
  width:100%;padding:14px;border:none;border-radius:8px;margin:10px 0
}
button{background:#ff9800;font-size:16px}
.circle{
  width:160px;height:160px;border-radius:50%;
  margin:20px auto;display:flex;align-items:center;justify-content:center;
  font-size:32px;box-shadow:0 0 20px #ff9800
}
.pulse{animation:pulse 1.5s infinite}
@keyframes pulse{
  0%{box-shadow:0 0 15px #ff9800}
  50%{box-shadow:0 0 40px #ff5722}
  100%{box-shadow:0 0 15px #ff9800}
}
.mantra{font-size:20px;min-height:30px}
.profile{font-size:14px;margin-top:10px}
</style>
</head>

<body>

<div class="container">

<!-- LOGIN -->
<div id="loginBox">
  <h2>Naam Jaap</h2>
  <input id="mobile" placeholder="Mobile Number">
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="appBox" class="hidden">
  <div id="circle" class="circle">ॐ</div>
  <div id="mantra" class="mantra"></div>
  <button id="startBtn" onclick="toggleJaap()">Start Jaap</button>
  <div id="profile" class="profile"></div>
</div>

</div>

<script>
let listening=false;
let sessionCount=0;

const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
const recognition=SpeechRecognition?new SpeechRecognition():null;

if(recognition){
  recognition.lang='hi-IN';
  recognition.continuous=true;
  recognition.onresult=e=>{
    const text=e.results[e.results.length-1][0].transcript.toLowerCase();
    document.getElementById('mantra').innerText=text;

    // COUNT "RADHA"
    const matches=text.match(/radha|राधा/g);
    if(matches){
      sessionCount+=matches.length;
      updateProfile(sessionCount,true);
    }
  }
}

function login(){
  const m=document.getElementById('mobile').value.trim();
  if(!m) return alert('Enter mobile number');

  localStorage.setItem('user',m);
  if(!localStorage.getItem(m)){
    localStorage.setItem(m,JSON.stringify({count:0}));
  }
  initApp();
}

function initApp(){
  const user=localStorage.getItem('user');
  if(!user) return;

  document.getElementById('loginBox').classList.add('hidden');
  document.getElementById('appBox').classList.remove('hidden');
  updateProfile(0,false);
}

function toggleJaap(){
  const btn=document.getElementById('startBtn');
  const circle=document.getElementById('circle');

  if(!listening){
    listening=true;
    sessionCount=0;
    btn.innerText='Stop Jaap';
    circle.classList.add('pulse');
    if(recognition) recognition.start();
  }else{
    listening=false;
    btn.innerText='Start Jaap';
    circle.classList.remove('pulse');
    if(recognition) recognition.stop();
    saveSession();
  }
}

function saveSession(){
  const user=localStorage.getItem('user');
  const data=JSON.parse(localStorage.getItem(user));
  data.count+=sessionCount;
  localStorage.setItem(user,JSON.stringify(data));
  updateProfile(0,false);
}

function updateProfile(current,live){
  const user=localStorage.getItem('user');
  const data=JSON.parse(localStorage.getItem(user));
  document.getElementById('profile').innerHTML=`
    Total Naam Jaap: <b>${data.count+(live?current:0)}</b><br>
    Current Session: <b>${current}</b>
  `;
}

initApp();
</script>

</body>
</html>
